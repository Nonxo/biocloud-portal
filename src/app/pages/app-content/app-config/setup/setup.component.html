<div *ngIf="editMode" class="modal-header">
    <h4 class="modal-title pull-left">{{title}}</h4>
    <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
        <span aria-hidden="true">&times;</span>
    </button>
</div>

<div class="container py-5">
    <form (ngSubmit)="submit()" name="addLocationForm" #addLocationForm="ngForm" ngNativeValidate>
        <div class="row">
            <div class="col-md-12">
                <mat-card>
                    <div class="row p-md-3 p-0">

                        <div class="col-md-12">
                            <h6 class="text-brand">Add Location</h6>
                        </div>

                        <div class="col-md-6">
                            <mat-form-field class="input-field">
                                <mat-select placeholder="Location Type" name="locType"
                                            [(ngModel)]="locRequest.locationType"
                                            (change)="clearData()" required>
                                    <mat-option value="">--</mat-option>
                                    <mat-option *ngFor="let locType of locationTypes" value="{{locType.value}}">
                                        {{locType.name}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <div class="col-md-6"
                             *ngIf="locRequest.locationType == 'COUNTRY' || locRequest.locationType == 'STATE'">
                            <mat-form-field class="input-field">
                                <mat-select placeholder="Select Country" name="country"
                                            [(ngModel)]="locRequest.countryId"
                                            (change)="fetchStates(locRequest.countryId)"
                                            [required]="locRequest.locationType == 'COUNTRY' || locRequest.locationType == 'STATE'">
                                    <mat-option value="0">--</mat-option>
                                    <mat-option *ngFor="let country of countries" value="{{country.id}}">
                                        {{country.name}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <div class="col-md-6" *ngIf="locRequest.locationType == 'STATE'">
                            <mat-form-field class="input-field">
                                <mat-select placeholder="Select State" name="states" [(ngModel)]="locRequest.stateId"
                                            [required]="locRequest.locationType == 'STATE'">
                                    <mat-option value="0">--</mat-option>
                                    <mat-option *ngFor="let state of states" value="{{state.id}}">{{state.name}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <div class="col-md-4" *ngIf="locRequest.locationType == 'SPECIFIC_ADDRESS'">
                            <mat-form-field class="input-field">
                                <input matInput placeholder="Address will appear here" name="address"
                                       [(ngModel)]="locRequest.address" disabled
                                       [required]="locRequest.locationType == 'SPECIFIC_ADDRESS'">
                            </mat-form-field>
                        </div>
                        <div class="col-md-1 d-none d-md-block" *ngIf="locRequest.locationType == 'SPECIFIC_ADDRESS'">
                            <i class="material-icons loc-icon" matTooltip="Use current Location"
                               (click)="getCurrentPosition(true)">place</i>
                        </div>
                        <div class="col-md-1  d-none d-md-block" *ngIf="locRequest.locationType == 'SPECIFIC_ADDRESS'">
                            <a (click)="openModal(template, false)"><i class="material-icons loc-icon"
                                                                       matTooltip="Use a map">public</i></a>
                        </div>

                        <div class="col-md-6" *ngIf="locRequest.address">
                            <button (click)="openModal(template, true)" mat-raised-button color="default"
                                    class="mat-btn" type="button">
                                Add Acceptable Range
                            </button>
                        </div>

                        <div class="col-md-6" *ngIf="locRequest.locationType">
                            <mat-form-field class="input-field">
                                <input matInput placeholder="Enter Branch/Business/Location Name" name="locName"
                                       [(ngModel)]="locRequest.name" required>
                            </mat-form-field>
                        </div>

                        <!--resumption time-->
                        <ng-container *ngIf="locRequest.locationType">
                            <div class="col-md-4">
                                <mat-form-field class="input-field">
                                    <input matInput type="time" pattern="[0-9]{2}:[0-9]{2}" placeholder="Resumption Time" name="rTime"
                                           [(ngModel)]="resumption">
                                    <mat-hint>Format (HH:MM AM/PM)</mat-hint>
                                </mat-form-field>
                            </div>
                            <div class="col-md-2">
                                <mat-form-field class="input-field">
                                    <mat-select placeholder="Select Timezone" name="timezone"
                                                [(ngModel)]="locRequest.resumptionTimezoneId">
                                        <mat-option value="">--</mat-option>
                                        <mat-option *ngFor="let timezone of timezones" value="{{timezone.zoneId}}">
                                            {{timezone.zoneId}} ({{timezone.offset}})
                                        </mat-option>
                                    </mat-select>
                                    <mat-hint *ngIf="resumption">Required</mat-hint>
                                </mat-form-field>
                            </div>
                        </ng-container>

                        <!--grace period-->
                        <div class="col-md-6" *ngIf="locRequest.locationType">
                            <mat-form-field class="input-field">
                                <input matInput type="number" min="0" placeholder="Enter a grace period in minutes"
                                       name="gracePeriod" [(ngModel)]="locRequest.gracePeriodInMinutes">
                            </mat-form-field>
                        </div>

                        <div class="col-md-12 text-right" *ngIf="!editMode">
                            <button mat-mini-fab color="accent" matTooltip="Add another location" [disabled]="addLocationForm.invalid" type="button" (click)="addnewLocation()">
                                <mat-icon>add</mat-icon>
                            </button>
                        </div>
                    </div>
                </mat-card>
            </div>


            <div class="col-md-12 pt-4 text-right">
                <button mat-raised-button color="primary" [disabled]="addLocationForm.invalid" class="mat-btn" type="submit">{{editMode? 'SAVE':'PROCEED'}}</button>
            </div>
        </div>
    </form>
</div>


<ng-template #template>
    <div class="modal-header">
        <h5 class="modal-title pull-left">Map</h5>
        <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">

        <div class="col-md-12">
            <div class="row p-md-3 p-0">
                <div class="col-md-6">
                    <mat-form-field *ngIf="!addRange" class="input-field">
                        <input matInput placeholder="Search" id="autocompleteInput">
                    </mat-form-field>

                    <mat-form-field *ngIf="addRange" class="input-field">
                        <input matInput type="number" placeholder="Enter Radius" name="radius"
                               [(ngModel)]="locRequest.radiusThreshold">
                    </mat-form-field>
                </div>

                <div class="col-md-4 text-right">
                    <button (click)="useAddress()" mat-raised-button color="primary" class="mat-btn">USE</button>
                </div>
            </div>
        </div>

        <div class="col-md-12">
            <agm-map [latitude]="lat" [longitude]="lng" [zoom]="zoomSize" (mapClick)="mapClicked($event)">
                <agm-marker [latitude]="lat" [longitude]="lng" [markerDraggable]="draggable"
                            (dragEnd)="markerDragEnd($event)"></agm-marker>

                <agm-circle *ngIf="addRange" [latitude]="lat" [longitude]="lng"
                            [radius]="locRequest.radiusThreshold">
                </agm-circle>
            </agm-map>
        </div>
    </div>
</ng-template>